# 家庭用ストック管理アプリ 仕様書

## 1. アプリケーション概要
「家にあれあったっけ？」を解消するための、個体数ベースの在庫管理・購入履歴記録アプリです。

## 2. コアコンセプト
- **個体カウント**: 重さ（g）や量（ml）ではなく、本数や個数（ボトル、パック）を最小単位として管理します。
- **柔軟なメモ**: 同じ商品でもサイズが異なる場合は、商品マスタを分けずに購入時の「容量・メモ」で記録することで管理を簡略化します。
- **入力の簡素化**: 買い物は1件ずつサクッと登録し、単価入力のストレス（初期値0の削除、ポップアップ等）を排除しています。

## 3. 主要機能

### 3.1 在庫管理 (Dashboard)
- **一覧表示**: 登録されている全商品の現在の在庫数（個）を表示します。モバイル向けに最適化されたコンパクトなリスト表示を採用し、スクロール量を抑制しています。
- **クイック調整（楽観的UI）**: 「+1」「-1」ボタンにより、買い物を通さずとも手軽に在庫数を修正可能です。**楽観的UI（Optimistic UI）**を導入しており、ネットワークの遅延に関わらずボタンを押した瞬間に在庫表示が更新され、サクサクとした操作感を実現しています。
- **カテゴリフィルタ**: 作成したカテゴリで表示商品を絞り込めます。
- **並び替え機能**: 「多い順」「少ない順」でリストをソート可能です。
- **商品詳細リンク**: 商品名をクリックすることで、その商品の購入履歴（価格履歴）へ遷移できます。

### 3.2 買い物登録 (Purchase Log)
- **単一登録**: 一度の操作で1つの商品の購入を記録します。
- **直近のお店の自動選択**: 最後に利用したお店が初期状態で選択され、入力を省力化します。
- **入力項目**:
    - 購入日（デフォルトは今日）
    - お店（登録済みリストから選択）
    - 商品名（登録済みリストから選択）
    - 購入個数（何本、何パック買ったか）
    - **容量・メモ**: 「100ml」「詰め替え」など自由に記載。
    - 単価: 1つあたりの金額。
- **連動**: 登録完了と同時に、在庫数が「購入個数」分だけ加算されます。

### 3.3 商品管理 (Master Data)
- **商品登録**: 「商品名」と「カテゴリ」のみのシンプル構成です。
- **カテゴリインライン編集**: 商品一覧ページから、各商品のカテゴリをその場ですぐに変更可能です。
- **商品メモ**: 各商品ごとに、特徴や使い方などを自由に保存・編集できる常時表示のメモ欄があります。
- **商品詳細（価格履歴）**:
    - 過去の購入記録を時系列で表示。
    - **容量メモの編集**: 過去の履歴の容量・メモ（サイズ等）を後から自由に変更可能です。
    - **履歴の削除**: 誤った購入記録を削除できます（在庫数は変更されません）。
    - **クイック購入**: その商品を直近で買ったお店が自動選択された状態で、即座に購入登録できるフォームがあります。
- **削除機能**: 不要になった商品を削除可能です（確認ダイアログ付き）。

### 3.4 お店管理
- **店名登録**: 店名のみのシンプル管理です。
- **自由な並び替え**: 矢印ボタンで、よく行く店を上に持ってくるなど任意の順番に入れ替え可能です。
- **削除機能**: お店を削除しても、過去の購入履歴データ自体は維持されます。

### 3.5 カテゴリ管理
- **カテゴリ作成**: 独自のカテゴリ（例: 非常食、おやつ）を自由に追加できます。
- **自由な並び替え**: 矢印ボタンで任意の表示順に変更可能です。
- **削除時の挙動**: カテゴリを削除しても、そのカテゴリだった商品は「未分類」として維持されます。

## 4. 技術スタック
- **Frontend**: Next.js 15 (App Router)
- **Styling**: Tailwind CSS, Shadcn/UI
- **Backend/Database**: Supabase (PostgreSQL)
- **Deployment**: Vercel

## 5. データ構造 (Supabase)
- `categories`: カテゴリ情報（`sort_order` を含む）
- `products`: 商品基本情報（`memo`, `category_id` を含む）
- `stores`: 店舗情報（`sort_order` を含む）
- `purchases`: 購入イベントのヘッダー
- `purchase_lines`: 購入明細（`size_info` カラムに容量メモを保持）
- `stock`: 在庫スナップショット
- `stock_adjustments`: 手動調整履歴

## 6. 運用ガイド
同じ「洗剤」でも、ボトル（1つ）と詰め替え（1つ）を在庫上は同じ「1」としてカウントする運用を推奨します。価格の比較は、詳細画面の履歴に表示される「容量メモ」を参照して判断します。
